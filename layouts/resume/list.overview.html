{{ define "head" }}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ProfilePage",
    "mainEntity": {
      "@type": "Person",
      "name": {{ .Site.Params.author.name | default .Site.Title | jsonify }},
      "url": {{ .Permalink | jsonify }}
    },
    "headline": {{ .Title | jsonify }},
    "description": {{ with .Params.description }}{{ . | jsonify }}{{ else }}{{ .Summary | plainify | jsonify }}{{ end }}
  }
  </script>
  <style>
    .resume-section-toggle {
      cursor: pointer;
      user-select: none;
      position: relative;
      transition: color 0.2s ease;
    }
    .resume-section-toggle:hover {
      color: var(--color-primary, #3b82f6);
    }
    .toggle-icon {
      font-size: 0.8em;
      margin-left: 0.5rem;
      transition: transform 0.3s ease;
      display: inline-block;
    }
    .resume-section-toggle.collapsed .toggle-icon {
      transform: rotate(-90deg);
    }
    .resume-section-detail-content {
      overflow: hidden;
      transition: max-height 0.3s ease, opacity 0.3s ease;
      max-height: 1000px;
      opacity: 1;
    }
    .resume-section-detail-content.collapsed {
      max-height: 0 !important;
      opacity: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    .resume-section-description {
      font-style: italic;
      color: var(--color-text-2, #666);
      margin: 0.5rem 0 1rem 0;
      padding: 0.75rem 1rem;
      background: var(--color-bg-2, #f8f9fa);
      border-left: 3px solid var(--color-primary, #3b82f6);
      border-radius: 0 6px 6px 0;
      font-size: 0.95em;
      line-height: 1.5;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .resume-section-description:before {
      content: "ğŸ’¡ ";
      margin-right: 0.25rem;
    }
  </style>
{{ end }}

{{ define "main" }}
  <article>
    <header class="max-w-prose">
      <h1 class="mb-3 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        {{ .Title | emojify }}
      </h1>
      {{ with .Params.avatar }}
        <img src="{{ . }}" alt="avatar" class="mb-6 h-14 w-12 rounded-md object-cover border border-neutral-300 shadow-sm dark:border-neutral-600" />
      {{ end }}
      {{ with .Params.description }}
        <p class="mb-6 text-base text-neutral-500 dark:text-neutral-400">{{ . }}</p>
      {{ end }}
    </header>

    <section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row">
      {{ if in .TableOfContents "<ul" }}
        <div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8">
          <div class="toc pe-5 lg:sticky lg:top-10 print:hidden">
            {{ partial "toc.html" . }}
          </div>
        </div>
      {{ end }}
      <div class="min-h-0 min-w-0 max-w-prose grow">
        {{ $content := .Content | emojify }}
        {{ $content = replace $content "<h3>" "<h3 class=\"resume-section-toggle\" data-toggle=\"section\">" }}
        {{ $content = replace $content "</h3>" "<span class=\"toggle-icon\">â–¼</span></h3>" }}
        {{ $content = replace $content "<h3 class=\"resume-section-toggle\" data-toggle=\"section\">" "<h3 class=\"resume-section-toggle\" data-toggle=\"section\">" }}
        {{ $content | safeHTML }}
      </div>
    </section>
  </article>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // å¤„ç†ä¸‰çº§æ ‡é¢˜çš„å±•å¼€/æŠ˜å 
      const h3Elements = document.querySelectorAll('h3');
      
      h3Elements.forEach(h3 => {
        // æ£€æŸ¥æ˜¯å¦åŒ…å«æè¿°ï¼ˆæ–œä½“æ–‡æœ¬ï¼‰
        const nextElement = h3.nextElementSibling;
        if (nextElement && nextElement.tagName === 'P' && nextElement.querySelector('em')) {
          const description = nextElement.querySelector('em').textContent;
          
          // åˆ›å»ºå¯ç‚¹å‡»çš„æ ‡é¢˜
          h3.style.cursor = 'pointer';
          h3.style.userSelect = 'none';
          
          // æ·»åŠ å±•å¼€/æŠ˜å å›¾æ ‡
          const toggleIcon = document.createElement('span');
          toggleIcon.textContent = 'â–¶';
          toggleIcon.style.marginLeft = '0.5rem';
          toggleIcon.style.transition = 'transform 0.3s ease';
          toggleIcon.style.display = 'inline-block';
          h3.appendChild(toggleIcon);
          
          // åˆ›å»ºæè¿°å®¹å™¨
          const descriptionDiv = document.createElement('div');
          descriptionDiv.className = 'resume-section-description';
          descriptionDiv.textContent = description;
          
          // åˆ›å»ºè¯¦ç»†å†…å®¹å®¹å™¨
          const detailContentDiv = document.createElement('div');
          detailContentDiv.className = 'resume-section-detail-content';
          
          // æ”¶é›†è¯¥æ ‡é¢˜ä¸‹çš„æ‰€æœ‰å†…å®¹ï¼ˆç›´åˆ°ä¸‹ä¸€ä¸ªh2æˆ–h3ï¼‰
          let currentElement = nextElement.nextElementSibling;
          while (currentElement && currentElement.tagName !== 'H3' && currentElement.tagName !== 'H2') {
            const nextSibling = currentElement.nextElementSibling;
            detailContentDiv.appendChild(currentElement);
            currentElement = nextSibling;
          }
          
          // é‡æ–°ç»„ç»‡DOMç»“æ„
          // 1. ç§»é™¤åŸæ¥çš„æè¿°æ®µè½
          h3.parentNode.removeChild(nextElement);
          
          // 2. æ’å…¥æè¿°å®¹å™¨
          h3.parentNode.insertBefore(descriptionDiv, currentElement);
          
          // 3. æ’å…¥è¯¦ç»†å†…å®¹å®¹å™¨
          h3.parentNode.insertBefore(detailContentDiv, currentElement);
          
          // é»˜è®¤ç®€ç•¥æ¨¡å¼ï¼ˆåªæ˜¾ç¤ºæè¿°ï¼‰
          let isDetailed = false;
          
          // ç«‹å³åº”ç”¨é»˜è®¤çŠ¶æ€
          setTimeout(() => {
            detailContentDiv.classList.add('collapsed');
            toggleIcon.style.transform = 'rotate(0deg)';
            descriptionDiv.style.display = 'block';
          }, 0);
          
          // ç‚¹å‡»äº‹ä»¶
          h3.addEventListener('click', function() {
            isDetailed = !isDetailed;
            
            if (isDetailed) {
              // è¯¦ç»†æ¨¡å¼ï¼šæ˜¾ç¤ºè¯¦ç»†å†…å®¹ï¼Œéšè—æè¿°
              detailContentDiv.classList.remove('collapsed');
              toggleIcon.textContent = 'â–¼';
              toggleIcon.style.transform = 'rotate(0deg)';
              descriptionDiv.style.display = 'none';
            } else {
              // ç®€ç•¥æ¨¡å¼ï¼šåªæ˜¾ç¤ºæè¿°ï¼Œéšè—è¯¦ç»†å†…å®¹
              detailContentDiv.classList.add('collapsed');
              toggleIcon.textContent = 'â–¶';
              toggleIcon.style.transform = 'rotate(0deg)';
              descriptionDiv.style.display = 'block';
            }
          });
          
          // æ‚¬åœæ•ˆæœ
          h3.addEventListener('mouseenter', function() {
            h3.style.color = 'var(--color-primary, #3b82f6)';
          });
          
          h3.addEventListener('mouseleave', function() {
            h3.style.color = '';
          });
        }
      });
    });
  </script>
{{ end }}
